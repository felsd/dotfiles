#!/usr/bin/python
import os
import re
import subprocess
import sys

BAT_100_ICON = "î‚“"
BAT_75_ICON = "î‚’"
BAT_50_ICON = "î‚‘"
BAT_25_ICON = "ï‰ƒ"
BAT_0_ICON = "î‚"
EXCLAMATION_ICON = "î‚§"
# BATTERY_ICON = "ðŸ”‹"
# EXCLAMATION_ICON = "â—"

if __name__ == "__main__":
    pressed_button = os.environ.get("BLOCK_BUTTON")
    if pressed_button:
        pass
    else:
        bat_status = subprocess.check_output(
            ["cat", "/sys/class/power_supply/BAT0/status"],
            stdin=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL,
        ).decode("utf-8")
        if "arging" not in bat_status:
            os._exit(0)

        bat_capacity = subprocess.check_output(
            ["cat", "/sys/class/power_supply/BAT0/capacity"],
            stdin=subprocess.DEVNULL,
            stderr=subprocess.DEVNULL,
        ).decode("utf-8")
        perc = int(bat_capacity)
        icon = BAT_0_ICON
        if perc >= 75:
            icon = BAT_100_ICON
        elif perc >= 50:
            icon = BAT_75_ICON
        elif perc >= 25:
            icon = BAT_50_ICON
        elif perc >= 10:
            icon = BAT_25_ICON
        if perc <= 10:
            icon = EXCLAMATION_ICON
        sys.stdout.write(f"{icon}{perc}% | ")
